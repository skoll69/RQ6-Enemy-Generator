# Tox configuration to run pytest and Django's unittest runner
# Assumption: the environment (DB/container) is already up; tox will not start services.

[tox]
skipsdist = true
envlist = py310

[testenv]
deps =
    -rrequirements.txt
    -rrequirements_dev.txt
setenv =
    DJANGO_SETTINGS_MODULE = settings
    # Use the same DB as app; environment must provide DB_* variables
    # Example for local runs (override on CLI or via .env read by Django):
    # DB_NAME = mythras_eg
    # db_user = mythras_eg
    # db_password = password
    # DB_HOST = 127.0.0.1
    # DB_PORT = 3308
passenv =
    # Allow passing any DB_* envs from the shell into tox virtualenv
    DB_*
    db_user
    db_password
    MYSQL_*
    SKIP_TEST_LOADDATA
    PYTEST_ADDOPTS
commands =
    # Run pytest suite verbosely (default: exclude infra tests unless explicitly requested)
    pytest -vv
    #-m "not infra"
    # Also run Django's unittest runner for legacy tests (scoped to Django's unittest suite)
    python manage.py test enemygen.tests enemygen.legacy_tests --verbosity=2
